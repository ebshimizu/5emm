import{S as lt,ah as ut,ad as ft,a as i,aD as dt,by as pt,ag as p,bz as vt,bA as mt,ai as m,bB as At,bC as ht,bD as gt}from"./index.983957c9.js";const Ct={HP:"green-8",Attack:"red-10",Multiattack:"red-10",LimitedMultiattack:"red-10",Action:"amber-10",Trait:"teal-10",Legendary:"cyan-8",Spell:"purple-10","Lair Action":"blue-10"},Dt=()=>{const n=lt(),G=ut(),{t:f}=ft(),J=(t,e)=>{const o={totalDamage:0,actions:[]};if(t.length===0)return o;let s=Array.from(t);for(;e>0&&s.length>0;){let r=1,u=0;for(const a of s){const d=Math.max(1,a.cost);d>=r&&(r=d,a.damage>u&&(u=a.damage))}const l=s.map(a=>{const d=Math.max(a.cost,1);return{adjustedDamage:a.damage*Math.floor(r/d),addCount:Math.floor(r/d),...a,cost:d}});l.sort((a,d)=>d.adjustedDamage-a.adjustedDamage);for(let a=0;a<l[0].addCount;a++)o.totalDamage+=l[0].damage,o.actions.push(l[0]),e-=l[0].cost;s=s.filter(a=>a.cost<=e)}return o},K=t=>{const e=[].concat(t.attacks,t.actions,t.spells);return e.length===0?null:(e.sort((o,s)=>s.damage-o.damage),e[0])},R=t=>n.resistances==null||n.resistances.length===0?1:t<=4?2:t<=10?1.5:t<=16?1.25:1,I=t=>n.immunities==null||n.immunities.length===0?1:t<=10?2:t<=16?1.5:1.25,$=()=>n.vulnerabilities!=null&&n.vulnerabilities.length>0?.5:1,Q=t=>Ct[t],k=i(()=>{const t=dt.cloneDeep(n.attackInfo),e=J(t.legendary,t.legendaryCount),o=[];let s=null;for(let r=0;r<3;r++){const u={totalDamage:0,actions:[]},l=K(t);l&&(u.actions.push(l),u.totalDamage+=l.damage,"limited"in l&&l.limited?(l.uses-=1,l.uses<=0&&t.actions.splice(0,1)):l.type==="Spell"&&G.allSpells[l.name].level>0&&t.spells.splice(0,1));for(const a of t.traits)a.damage>0&&(u.actions.push(a),u.totalDamage+=a.damage,a.limited&&a.uses>0&&(a.uses-=1,a.remove=a.uses<=0));if(t.traits=t.traits.filter(a=>!a.remove),t.lairActions.length>0){const a=t.lairActions[0];a.damage>0&&(u.actions.push(a),u.totalDamage+=a.damage),s&&t.lairActions.push(s),s=a,t.lairActions=t.lairActions.slice(1),t.lairActions.sort((d,x)=>x.damage-d.damage)}u.totalDamage+=e.totalDamage,u.actions=u.actions.concat(e.actions),o.push(u)}return o}),E=i(()=>{if(k.value.length<3)return 0;let t=0;for(let e=0;e<3;e++)t+=k.value[e].totalDamage;return t/3}),A=i(()=>pt(E.value)),h=i(()=>{const t=[].concat(n.attackInfo.attacks,n.attackInfo.actions,n.attackInfo.traits,n.attackInfo.legendary,n.attackInfo.lairActions);return n.isSpellcaster&&t.push({name:"Spell Save DC",type:"Spell",damage:0,save:n.spellSave}),t.sort((e,o)=>{var s,r;return((s=o.save)!=null?s:0)-((r=e.save)!=null?r:0)}),t}),P=i(()=>h.value.filter(t=>{var e;return((e=t.save)!=null?e:0)>0})),S=i(()=>h.value.length===0?0:h.value[0].save),M=i(()=>{const t=h.value.filter(e=>e.type!=="Spell");return n.isSpellcaster&&t.push({name:"Spell Attack Modifier",type:"Spell",toHit:n.spellAttackModifier}),t.sort((e,o)=>{var s;return((s=o.toHit)!=null?s:0)-e.toHit}),t}),j=i(()=>M.value.map(t=>({toHitRender:p(t.toHit),...t})).filter(t=>t.toHit>0)),H=i(()=>M.value.length===0?0:M.value[0].toHit),U=i(()=>p(H.value)),w=i(()=>{var t;return((t=S.value)!=null?t:0)-A.value.saveDc}),O=i(()=>H.value-A.value.attack),W=i(()=>p(w.value)),X=i(()=>p(O.value)),Y=i(()=>{var t;return vt((t=S.value)!=null?t:0)}),Z=i(()=>mt(H.value)),g=i(()=>Y.value.numeric>=Z.value.numeric),C=i(()=>{const t=A.value.index;let e=0;g.value?e=w.value:e=O.value,e/=2;const o=t+(e<0?Math.ceil(e):Math.floor(e));return m[Math.max(0,Math.min(m.length-1,o))]}),L=i(()=>{const t=C.value.numeric-A.value.numeric;return p(t)}),tt=i(()=>g.value?f("editor.cr.attackCrInactive"):f("editor.cr.attackCrExplain",[L.value,X.value])),et=i(()=>g.value?f("editor.cr.dcCrExplain",[L.value,W.value]):f("editor.cr.dcCrInactive")),nt=i(()=>{var u,l,a,d,x,N,_,z,V;const t=[],e=n.autoEstimateDefenseCr?C.value:m[n.CR],o=R(e.numeric),s=I(e.numeric),r=$();o>1&&t.push({title:f("monster.resistances"),subtitle:f("editor.cr.atCr",[f("editor.cr.resistance",{n:(u=n.resistances)==null?void 0:u.length},(a=(l=n.resistances)==null?void 0:l.length)!=null?a:0),e.cr]),value:`x${o}`,type:"HP"}),s>1&&t.push({title:f("monster.immunities"),subtitle:f("editor.cr.atCr",[f("editor.cr.immunity",{n:(d=n.immunities)==null?void 0:d.length},(N=(x=n.immunities)==null?void 0:x.length)!=null?N:0),e.cr]),value:`x${s}`,type:"HP"}),r<1&&t.push({title:f("monster.vulnerabilities"),subtitle:f("editor.cr.atCr",[f("editor.cr.vulnerability",{n:(_=n.vulnerabilities)==null?void 0:_.length},(V=(z=n.vulnerabilities)==null?void 0:z.length)!=null?V:0),e.cr]),value:`x${r}`,type:"HP"});for(const c of n.actions)c.crAnnotation.include&&c.crAnnotation.ehpMultiplier!==1&&t.push({title:c.name,subtitle:"Action",type:"Action",value:`x${c.crAnnotation.ehpMultiplier.toFixed(1)}`});for(const c of n.traits)c.crAnnotation.include&&c.crAnnotation.ehpMultiplier!==1&&t.push({title:c.name,subtitle:"Trait",type:"Trait",value:`x${c.crAnnotation.ehpMultiplier.toFixed(1)}`});for(const c in n.lairActions){const v=n.lairActions[c];v.crAnnotation.include&&v.crAnnotation.ehpMultiplier!==1&&t.push({title:`Lair Action ${c+1}`,subtitle:"Lair Action",type:"Lair Action",value:`x${v.crAnnotation.ehpMultiplier.toFixed(1)}`})}for(const c of n.actions)c.crAnnotation.include&&c.crAnnotation.ehpModifier!==0&&t.push({title:c.name,subtitle:"Action",type:"Action",value:p(c.crAnnotation.ehpModifier)});for(const c of n.traits)c.crAnnotation.include&&c.crAnnotation.ehpModifier!==0&&t.push({title:c.name,subtitle:"Trait",type:"Trait",value:p(c.crAnnotation.ehpModifier)});for(const c in n.lairActions){const v=n.lairActions[c];v.crAnnotation.include&&v.crAnnotation.ehpModifier!==0&&t.push({title:`Lair Action ${c+1}`,subtitle:"Lair Action",type:"Lair Action",value:p(v.crAnnotation.ehpModifier)})}return t}),F=i(()=>{let e=n.avgHp;const o=n.autoEstimateDefenseCr?C.value:m[n.CR];e*=R(o.numeric)*I(o.numeric)*$();for(const r of n.actions)r.crAnnotation.include&&(e*=r.crAnnotation.ehpMultiplier);for(const r of n.lairActions)r.crAnnotation.include&&(e*=r.crAnnotation.ehpMultiplier);for(const r of n.traits)r.crAnnotation.include&&(e*=r.crAnnotation.ehpMultiplier);for(const r of n.actions)r.crAnnotation.include&&(e+=r.crAnnotation.ehpModifier);for(const r of n.lairActions)r.crAnnotation.include&&(e+=r.crAnnotation.ehpModifier);for(const r of n.traits)r.crAnnotation.include&&(e+=r.crAnnotation.ehpModifier);return e}),D=i(()=>Object.values(n.saves).filter(t=>t.proficient||t.override&&t.overrideValue>0).length),T=i(()=>D.value<3?0:D.value<5?2:4),it=i(()=>{const t=[];T.value>0&&t.push({title:"Saving Throws",subtitle:f("editor.cr.saveCount",{n:D.value},D.value),type:"HP",value:`+${T.value}`});for(const e of n.actions)e.crAnnotation.include&&e.crAnnotation.acModifier!==0&&t.push({title:e.name,subtitle:"Action",type:"Action",value:p(e.crAnnotation.acModifier)});for(const e in n.lairActions){const o=n.lairActions[e];o.crAnnotation.include&&o.crAnnotation.acModifier!==0&&t.push({title:`Lair Action ${e+1}`,subtitle:"Lair Action",type:"Lair Action",value:p(o.crAnnotation.acModifier)})}for(const e of n.traits)e.crAnnotation.include&&e.crAnnotation.acModifier!==0&&t.push({title:e.name,subtitle:"Trait",type:"Trait",value:p(e.crAnnotation.acModifier)});return t}),B=i(()=>{let t=n.AC+T.value;for(const e of n.actions)e.crAnnotation.include&&(t+=e.crAnnotation.acModifier);for(const e of n.lairActions)e.crAnnotation.include&&(t+=e.crAnnotation.acModifier);for(const e of n.traits)e.crAnnotation.include&&(t+=e.crAnnotation.acModifier);return Math.max(12,t)}),y=i(()=>At(F.value)),at=i(()=>ht(B.value)),b=i(()=>{const t=y.value.index,e=(B.value-y.value.ac)/2,o=t+(e<0?Math.ceil(e):Math.floor(e));return m[Math.max(0,Math.min(m.length-1,o))]}),q=i(()=>{const t=b.value.numeric-y.value.numeric;return p(t)}),rt=i(()=>g.value?"dark":"red-10"),ot=i(()=>g.value?"red-10":"dark"),ct=i(()=>f("editor.cr.acExplain",[q.value,p(at.value.ac-b.value.ac)])),st=i(()=>{const t=(C.value.numeric+b.value.numeric)/2;return gt(t)});return{actionSequence:k,actionTypeColor:Q,attackCrExplain:tt,damagePerRound:E,damageCr:A,maxDc:S,maxAttackRender:U,attackCrDelta:L,attackChipColor:rt,actionsBelowThreshold:i(()=>M.value.length-j.value.length),filteredToHitActions:j,filteredDcActions:P,dcChipColor:ot,dcCrExplain:et,dcsBelowThreshold:i(()=>h.value.length-P.value.length),offensiveCr:C,ehp:F,hpCr:y,ehpModifierList:nt,eac:B,acCrDelta:q,acCrExplain:ct,eacModifierList:it,defensiveCr:b,estimatedCr:st}};export{Ct as A,Dt as u};
